<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Laboratório 3 - Parte 2</title>
    <meta name="description" content="Resultados dos laboratórios da disciplina.
">

    <link rel="stylesheet" href="/AD2/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/AD2/2018/02/lab-3-parte-2.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/AD2/">Análise de Dados 2</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/AD2/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Laboratório 3 - Parte 2</h1>
    <p class="post-meta">Feb 3, 2018</p>
  </header>

  <article class="post-content">
    
<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">knitr</span><span class="o">::</span><span class="n">opts_chunk</span><span class="o">$</span><span class="n">set</span><span class="p">(</span><span class="n">screenshot.force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span></code></pre></figure>

<p>Esta é a continuação do laboratório 3. Aqui damos continuidade ao tema “evasão no primeiro período”. Na parte 1 foi feita a análise descritiva dos dados, nesta parte 2 estaremos utilizando algoritmos de classificação para tentar prever evasão de alunos no curso de computação ao fim do primeiro período.</p>

<h3 id="separao-dos-dados-em-treino-e-teste">Separação dos dados em treino e teste</h3>

<p>A utilização dos dados será feita a partir do ano 2011, já que é a partir desse ano que se observa um aumento considerável no número de matrículas, enquanto o número de evasões permanece semelhante nos anos seguintes.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dados</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"treino_classificacao_v2.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">mat_unicas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">dados</span><span class="p">[,</span><span class="m">1</span><span class="p">]),]</span><span class="w">

</span><span class="n">contagem.distr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">mat_unicas</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_TUR_ANO</span><span class="p">,</span><span class="w"> </span><span class="n">EVADIU</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">

</span><span class="n">hchart</span><span class="p">(</span><span class="n">contagem.distr</span><span class="p">,</span><span class="w"> </span><span class="s2">"column"</span><span class="p">,</span><span class="w"> </span><span class="n">hcaes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAT_TUR_ANO</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EVADIU</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Não evadiu'</span><span class="p">,</span><span class="w"> </span><span class="s2">"Evadiu"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="n">hc_title</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribuição das classes"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">hc_colors</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"darkblue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orange"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">hc_yAxis</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Total de alunos"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">hc_xAxis</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ano"</span><span class="p">))</span></code></pre></figure>

<div class="figure">
<!--html_preserve--><div id="htmlwidget-3c60821b162b7320dea0" style="width:100%;height:500px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-3c60821b162b7320dea0">{"x":{"hc_opts":{"title":{"text":"Distribuição das classes"},"yAxis":{"title":{"text":"Total de alunos"},"type":"linear"},"credits":{"enabled":false},"exporting":{"enabled":false},"plotOptions":{"series":{"turboThreshold":0,"showInLegend":true,"marker":{"enabled":true}},"treemap":{"layoutAlgorithm":"squarified"},"bubble":{"minSize":5,"maxSize":25},"scatter":{"marker":{"symbol":"circle"}}},"annotationsOptions":{"enabledButtons":false},"tooltip":{"delayForDisplay":10},"series":[{"group":false,"data":[{"MAT_TUR_ANO":2000,"EVADIU":false,"count":57,"x":2000,"y":57},{"MAT_TUR_ANO":2001,"EVADIU":false,"count":57,"x":2001,"y":57},{"MAT_TUR_ANO":2002,"EVADIU":false,"count":57,"x":2002,"y":57},{"MAT_TUR_ANO":2003,"EVADIU":false,"count":57,"x":2003,"y":57},{"MAT_TUR_ANO":2004,"EVADIU":false,"count":57,"x":2004,"y":57},{"MAT_TUR_ANO":2005,"EVADIU":false,"count":52,"x":2005,"y":52},{"MAT_TUR_ANO":2006,"EVADIU":false,"count":53,"x":2006,"y":53},{"MAT_TUR_ANO":2007,"EVADIU":false,"count":39,"x":2007,"y":39},{"MAT_TUR_ANO":2008,"EVADIU":false,"count":53,"x":2008,"y":53},{"MAT_TUR_ANO":2009,"EVADIU":false,"count":58,"x":2009,"y":58},{"MAT_TUR_ANO":2010,"EVADIU":false,"count":78,"x":2010,"y":78},{"MAT_TUR_ANO":2011,"EVADIU":false,"count":98,"x":2011,"y":98},{"MAT_TUR_ANO":2012,"EVADIU":false,"count":117,"x":2012,"y":117},{"MAT_TUR_ANO":2013,"EVADIU":false,"count":102,"x":2013,"y":102},{"MAT_TUR_ANO":2014,"EVADIU":false,"count":118,"x":2014,"y":118},{"MAT_TUR_ANO":2015,"EVADIU":false,"count":172,"x":2015,"y":172}],"type":"column","name":"Não evadiu"},{"group":true,"data":[{"MAT_TUR_ANO":2000,"EVADIU":true,"count":3,"x":2000,"y":3},{"MAT_TUR_ANO":2001,"EVADIU":true,"count":3,"x":2001,"y":3},{"MAT_TUR_ANO":2003,"EVADIU":true,"count":1,"x":2003,"y":1},{"MAT_TUR_ANO":2004,"EVADIU":true,"count":1,"x":2004,"y":1},{"MAT_TUR_ANO":2005,"EVADIU":true,"count":2,"x":2005,"y":2},{"MAT_TUR_ANO":2006,"EVADIU":true,"count":2,"x":2006,"y":2},{"MAT_TUR_ANO":2007,"EVADIU":true,"count":10,"x":2007,"y":10},{"MAT_TUR_ANO":2008,"EVADIU":true,"count":1,"x":2008,"y":1},{"MAT_TUR_ANO":2009,"EVADIU":true,"count":11,"x":2009,"y":11},{"MAT_TUR_ANO":2010,"EVADIU":true,"count":5,"x":2010,"y":5},{"MAT_TUR_ANO":2011,"EVADIU":true,"count":15,"x":2011,"y":15},{"MAT_TUR_ANO":2012,"EVADIU":true,"count":16,"x":2012,"y":16},{"MAT_TUR_ANO":2013,"EVADIU":true,"count":16,"x":2013,"y":16},{"MAT_TUR_ANO":2014,"EVADIU":true,"count":15,"x":2014,"y":15},{"MAT_TUR_ANO":2015,"EVADIU":true,"count":25,"x":2015,"y":25}],"type":"column","name":"Evadiu"}],"xAxis":{"type":"linear","title":{"text":"Ano"}},"colors":["darkblue","orange"]},"theme":{"chart":{"backgroundColor":"transparent"}},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","drillUpText":"Back to {series.name}","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"thousandsSep":" ","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
<p class="caption">plot of chunk unnamed-chunk-2</p>
</div>

<p>Desses dados, os dividimos em treino e teste. Os dados de teste serão aqueles referentes as matrículas realizadas em 2015.2, o resto dos dados a partir de 2011 irão compor os dados de treino.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dados.treino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dados</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_TUR_ANO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2010</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">MAT_TUR_ANO</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2015</span><span class="p">))</span><span class="w">
</span><span class="n">dados.treino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dados</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_TUR_ANO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2015</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MAT_TUR_PERIODO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="n">dados.teste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">dados</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_TUR_ANO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2015</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MAT_TUR_PERIODO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="n">dados.treino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.treino</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">MAT_TUR_DIS_DISCIPLINA</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_TUR_ANO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_TUR_PERIODO</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="p">))</span><span class="w">
</span><span class="n">dados.teste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.teste</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">MAT_TUR_DIS_DISCIPLINA</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_TUR_ANO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_TUR_PERIODO</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="p">))</span><span class="w">

</span><span class="n">alunos.evadiu.treino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.treino</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">any</span><span class="p">(</span><span class="n">EVADIU</span><span class="p">))</span><span class="w">

</span><span class="n">alunos.evadiu.teste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.teste</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">any</span><span class="p">(</span><span class="n">EVADIU</span><span class="p">))</span><span class="w">

</span><span class="n">dados.treino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.treino</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="n">disciplina</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="n">disciplina</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_MEDIA_FINAL</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">disciplina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"."</span><span class="p">,</span><span class="n">disciplina</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dcast</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">disciplina</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">merge</span><span class="p">(</span><span class="n">alunos.evadiu.treino</span><span class="p">)</span><span class="w">

</span><span class="n">dados.teste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.teste</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="n">disciplina</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">MAT_MEDIA_FINAL</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="n">disciplina</span><span class="p">,</span><span class="w"> </span><span class="n">MAT_MEDIA_FINAL</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">disciplina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"."</span><span class="p">,</span><span class="n">disciplina</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dcast</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">disciplina</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">merge</span><span class="p">(</span><span class="n">alunos.evadiu.teste</span><span class="p">)</span></code></pre></figure>

<h3 id="adicionando-atributos">Adicionando atributos</h3>

<p>Percebemos que algumas notas de disciplinas estão com valores vazios. Para que não precisemos remover toda a linha do data frame, vamos realizar imputação de dados. Decidimos que os valores vazios em disciplinas serão substituídos pelo valor da média das notas presentes.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">)){</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">)){</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])){</span><span class="w">
      </span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">6</span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">])))</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dados.teste</span><span class="p">)){</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.teste</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])){</span><span class="w">
        </span><span class="n">dados.teste</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">6</span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">])))</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##                  MAT_ALU_MATRICULA
## 1 0044fe18610b0e666a8630b6b7f98386
## 2 0049c0b6a2e2db661f8e15e7bc2b7581
## 3 0134dc0b387e4dff42a0d2b45423564b
## 4 0189d03cbf10376083a4a70ec39dab90
## 5 01cb852b7b7bc76cc99e7f32376d7166
## 6 02188304b2556b3bd0a6a4f4bc2f1f4d
##   Álgebra.Vetorial.e.Geometria.Analítica
## 1                                    9.4
## 2                                    1.0
## 3                                    7.8
## 4                                    2.0
## 5                                    7.0
## 6                                    3.8
##   Cálculo.Diferencial.e.Integral.I Introdução.à.Computação
## 1                              8.5                     8.8
## 2                              0.7                     8.6
## 3                              6.3                     8.0
## 4                              3.8                     5.3
## 5                              0.0                     5.0
## 6                              3.4                     7.2
##   Laboratório.de.Programação.I Leitura.e.Produção.de.Textos
## 1                          8.4                         9.30
## 2                          8.8                         5.54
## 3                          8.4                         7.76
## 4                          5.1                         7.40
## 5                          3.8                         7.50
## 6                          7.4                         7.80
##   Programação.I evadiu
## 1           8.3  FALSE
## 2           8.6  FALSE
## 3           8.3  FALSE
## 4           5.1  FALSE
## 5           3.8  FALSE
## 6           7.4  FALSE</code></pre></figure>

<p>Para um novo atributo, decidimos que será uma variável categórica chamada <strong>Programacao</strong>. Se o aluno reprovou Programação I ou Lab. de Programação I, o valor será TRUE, caso contrário, FALSE.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Laborat</span><span class="err">ó</span><span class="n">rio.de.Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="w">
</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Laborat</span><span class="err">ó</span><span class="n">rio.de.Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="w">

</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="w">
</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span></code></pre></figure>

<h3 id="treino---modelos-de-regresso-logstica">Treino - Modelos de regressão logística</h3>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="p">)</span><span class="w">
</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">evadiu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">evadiu</span><span class="p">)</span><span class="w">

</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="p">)</span><span class="w">
</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="p">)</span><span class="w">

</span><span class="n">model.gml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w">
                   </span><span class="n">data</span><span class="o">=</span><span class="n">dados.treino</span><span class="p">,</span><span class="w">
                   </span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">,</span><span class="w">
                   </span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span></code></pre></figure>

<h3 id="treino---modelos-de-rvore-de-deciso">Treino - Modelos de árvore de decisão</h3>

<p>Tivemos que substituir os valores da variável criada por valores numéricos porque a função de criar o modelo não estava aceitando a variável caregórica.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dtf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">dados.treino</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Programacao</span><span class="p">)</span><span class="w">
</span><span class="n">dtf2</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="o">==</span><span class="nb">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">dtf2</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">Programacao</span><span class="o">==</span><span class="nb">F</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w">

</span><span class="n">model.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpart</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">dtf2</span><span class="p">)</span></code></pre></figure>

<h3 id="interpretao-de-coeficientes-da-regresso">Interpretação de coeficientes da regressão</h3>

<p>Vemos abaixo que as variáveis mais significativas são Leitura.e.Produção.de.Texto e Introdução.à.Computação. Essas variáveis apresentam os menores p-valores, o que para mim não faz muito sentido. Talvez essa importância seja resultado da imputação dos dados.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">model.gml</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## 
## Call:
## NULL
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0043  -0.2656  -0.2042  -0.1575   2.9912  
## 
## Coefficients:
##                                        Estimate Std. Error z value
## (Intercept)                             2.44665    1.24505   1.965
## Álgebra.Vetorial.e.Geometria.Analítica  0.14095    0.12996   1.085
## Cálculo.Diferencial.e.Integral.I       -0.02382    0.11934  -0.200
## Introdução.à.Computação                -0.27365    0.13146  -2.082
## Laboratório.de.Programação.I            0.22050    0.42583   0.518
## Leitura.e.Produção.de.Textos           -0.63918    0.14586  -4.382
## Programação.I                          -0.20915    0.40949  -0.511
## ProgramacaoTRUE                         0.45035    0.83894   0.537
##                                        Pr(&gt;|z|)    
## (Intercept)                              0.0494 *  
## Álgebra.Vetorial.e.Geometria.Analítica   0.2781    
## Cálculo.Diferencial.e.Integral.I         0.8418    
## Introdução.à.Computação                  0.0374 *  
## Laboratório.de.Programação.I             0.6046    
## Leitura.e.Produção.de.Textos           1.18e-05 ***
## Programação.I                            0.6095    
## ProgramacaoTRUE                          0.5914    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 362.94  on 575  degrees of freedom
## Residual deviance: 194.56  on 568  degrees of freedom
## AIC: 210.56
## 
## Number of Fisher Scoring iterations: 6</code></pre></figure>

<h3 id="acurcia-precision-e-recall-no-treino-e-teste">Acurácia, precision e recall no treino e teste</h3>

<ul>
  <li><strong>TP</strong>: true-positive;</li>
  <li><strong>TN</strong>: true-negative;</li>
  <li><strong>FP</strong>: false-positive;</li>
  <li>
    <p><strong>FN</strong>: false-negative.</p>
  </li>
  <li><strong>Acurácia</strong>: proporção de observações corretamente classificadas. (TP+TN)/(TP+TN+FP+FN);</li>
  <li><strong>Precisão</strong>: quantas das observaçoes preditas como positivas são realmente positivas. TP/(TP+FP);</li>
  <li><strong>Recall</strong>: quantas observaçoes positivas foram corretamente classificadas. TP/(TP+FN).</li>
</ul>

<h4 id="regresso-logstica">Regressão logística</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dados.teste</span><span class="o">$</span><span class="n">predicao.gml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model.gml</span><span class="p">,</span><span class="w"> </span><span class="n">dados.teste</span><span class="p">)</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.teste</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">predicao.gml</span><span class="p">)</span><span class="w">

</span><span class="n">TP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.gml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">TN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.gml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">FP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.gml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w"> 
</span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.gml</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span></code></pre></figure>

<p>Vemos abaixo que a acurácia do modelo parece boa, mais de 90% das previsões foram realizadas corretamente. Porém, os valores de precisão e recall são bem mais baixos. Com precisão igual a 0.5 siginifica que em metade das vezes foi prevista uma evasão quando não ocorreu. Com o valor de Recall aproximadamente igual a 0.57 significa que o modelo só preveu 57% dos alunos que evadiram. Essa característica se deve ao fato de que as classes estão desbalanceadas.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Acurácia: 0.923913043478261"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Precisão: 0.5"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Recall: 0.571428571428571"</code></pre></figure>

<h4 id="rvore-de-deciso">Árvore de decisão</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tst2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">dados.teste</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Programacao</span><span class="p">)</span><span class="w">
</span><span class="n">tst2</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="o">==</span><span class="nb">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">tst2</span><span class="o">$</span><span class="n">Programacao</span><span class="p">[</span><span class="n">dados.teste</span><span class="o">$</span><span class="n">Programacao</span><span class="o">==</span><span class="nb">F</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">model.tree</span><span class="p">,</span><span class="w"> </span><span class="n">tst2</span><span class="p">))</span><span class="w">

</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">predicao.tree</span><span class="p">[</span><span class="s1">'TRUE'</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)})</span><span class="w">
</span><span class="n">tst2</span><span class="o">$</span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">

</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tst2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">predicao.tree</span><span class="p">)</span><span class="w">

</span><span class="n">TP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">TN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">FP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w"> 
</span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span></code></pre></figure>

<p>Vemos abaixo que a acurácia do modelo parece boa, mais de 90% das previsões foram realizadas corretamente. Porém, não foi possível calcular a precisão, dado que, como não houve nenhuma ocorrência de valores TP e FP, não é possível realizar uma divisão por zero. De maneira análoga, o valor de Recall foi igual a zero, dado que TP também é igual a zero, implicando que o modelo não conseguiu prever a evasão de nenhum aluno. Mais uma vez, essa característica se deve ao fato de que as classes estão desbalanceadas e quando isso ocorre a acurácia do modelo será enganadora.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Acurácia: 0.923913043478261"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Precisão: NaN"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Recall: 0"</code></pre></figure>

<h3 id="controle-overfitting-usando-validao-cruzada">Controle overfitting usando validação-cruzada</h3>

<h4 id="regresso-logistica">Regressão Logistica</h4>

<h5 id="ridge">Ridge</h5>

<p>O modelo de regressão para ridge é ajustado chamando a função glmnet com alpha igual a 0. Glmnet desenvolve modelos em uma grade com cerca de 100 valores de lambda, como podemos ver no gráfico abaixo. Quando log de lambda é 4, todos os coeficientes são essencialmente zero. Então, à medida que relaxamos lambda, os coeficientes crescem de distanciando de zero.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="n">model.ridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model.matrix</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">-</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">dados.treino</span><span class="p">),</span><span class="w">
                </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="p">,</span><span class="w">
                </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
                </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'binomial'</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">model.ridge</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lambda"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span></code></pre></figure>

<p><img src="/AD2figure/source/lab-3-parte-2/2017-05-15-lab-3-parte-2/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<p>Para selecionar um modelo ridge executamos a função <strong>cv.glmnet</strong> que fará validação cruzada. Na parte superior do gráfico é possível ver quantos coeficientes de variáveis não-zero estão no modelo. Há todas as 7 variáveis no modelo, 6 variáveis e o intercept, e nenhum coeficiente é zero.</p>

<p>No início, o desvio binomial é mais alto e os coeficientes são pequenos até que, em algum ponto, ele se eleva e o intervalo é reduzido.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cv.ridge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">model.matrix</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">-</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">dados.treino</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">cv.ridge</span><span class="p">,</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span></code></pre></figure>

<p><img src="/AD2figure/source/lab-3-parte-2/2017-05-15-lab-3-parte-2/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<h5 id="lasso">Lasso</h5>

<p>O modelo de regressão para lasso é ajustado chamando a função glmnet com alpha igual a 1.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="n">model.lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model.matrix</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">-</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">dados.treino</span><span class="p">),</span><span class="w">
                </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="p">,</span><span class="w">
                </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
                </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'binomial'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">model.lasso</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lambda"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span></code></pre></figure>

<p><img src="/AD2figure/source/lab-3-parte-2/2017-05-15-lab-3-parte-2/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /></p>

<p>O plot tem várias opções, o desvio, por exemplo, está relacionado fraction deviance explained, que é equivalente a r-quadrado em regressão. Notamos que muito do r-quadrado foi explicado por basicamente duas variáveis, representadas pelas cores verde e azul claro.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">model.lasso</span><span class="p">,</span><span class="n">xvar</span><span class="o">=</span><span class="s2">"dev"</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p><img src="/AD2figure/source/lab-3-parte-2/2017-05-15-lab-3-parte-2/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<p>Coeficientes podem ser extraídos do glmmod. Aqui mostrado com 2 variáveis selecionadas. sendo elas Introdução.à.Computação e Leitura.e.Produção.de.Textos. Decidimos então que o melhor modelo para regressão logística será composto apenas por essas duas variáveis intependentes.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">coef</span><span class="p">(</span><span class="n">model.lasso</span><span class="p">)[,</span><span class="m">10</span><span class="p">]</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##                            (Intercept) 
##                             0.56035148 
##                            (Intercept) 
##                             0.00000000 
## Álgebra.Vetorial.e.Geometria.Analítica 
##                             0.00000000 
##       Cálculo.Diferencial.e.Integral.I 
##                             0.00000000 
##                Introdução.à.Computação 
##                            -0.04883549 
##           Laboratório.de.Programação.I 
##                             0.00000000 
##           Leitura.e.Produção.de.Textos 
##                            -0.38557798 
##                          Programação.I 
##                             0.00000000 
##                        ProgramacaoTRUE 
##                             0.00000000</code></pre></figure>

<p>Assim como em ridge, realizamos o processo para visualização da validação cruzada.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cv.lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">model.matrix</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="w"> </span><span class="o">-</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">dados.treino</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dados.treino</span><span class="o">$</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv.lasso</span><span class="p">)</span></code></pre></figure>

<p><img src="/AD2figure/source/lab-3-parte-2/2017-05-15-lab-3-parte-2/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /></p>

<p>E definimos o <strong>novo melhor modelo de regressão logística</strong>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="n">fitControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainControl</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cv"</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">best.glm.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model.lasso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Introdu</span><span class="err">çã</span><span class="n">o.</span><span class="err">à</span><span class="n">.Computa</span><span class="err">çã</span><span class="n">o</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Leitura.e.Produ</span><span class="err">çã</span><span class="n">o.de.Textos</span><span class="p">,</span><span class="w">
                   </span><span class="n">data</span><span class="o">=</span><span class="n">dados.treino</span><span class="p">,</span><span class="w">
                   </span><span class="n">method</span><span class="o">=</span><span class="s2">"glm"</span><span class="p">,</span><span class="w">
                   </span><span class="n">family</span><span class="o">=</span><span class="s2">"binomial"</span><span class="p">,</span><span class="w">
                   </span><span class="n">preProcess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'scale'</span><span class="p">,</span><span class="w"> </span><span class="s1">'center'</span><span class="p">),</span><span class="w">
                   </span><span class="n">trControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitControl</span><span class="p">,</span><span class="w">
                   </span><span class="n">na.action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.omit</span><span class="p">)</span></code></pre></figure>

<h4 id="rvore-de-deciso-1">Árvore de decisão</h4>

<p>Para a árvore de decisão, é utilizada a função rpart.control, definindo um valor máximo de altura igual a 30 (valor recomendado).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dt.control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpart.control</span><span class="p">(</span><span class="n">maxdepth</span><span class="o">=</span><span class="m">30</span><span class="p">)</span><span class="w">

</span><span class="n">model.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpart</span><span class="p">(</span><span class="n">evadiu</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">-</span><span class="n">MAT_ALU_MATRICULA</span><span class="p">,</span><span class="w">
                           </span><span class="n">data</span><span class="o">=</span><span class="n">dtf2</span><span class="p">,</span><span class="w">
                           </span><span class="n">method</span><span class="o">=</span><span class="s2">"class"</span><span class="p">,</span><span class="w">
                           </span><span class="n">control</span><span class="o">=</span><span class="n">dt.control</span><span class="p">)</span><span class="w">

</span><span class="n">printcp</span><span class="p">(</span><span class="n">model.tree</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## 
## Classification tree:
## rpart(formula = evadiu ~ . - MAT_ALU_MATRICULA, data = dtf2, 
##     method = "class", control = dt.control)
## 
## Variables actually used in tree construction:
## [1] Introdução.à.Computação      Leitura.e.Produção.de.Textos
## 
## Root node error: 55/576 = 0.095486
## 
## n= 576 
## 
##         CP nsplit rel error  xerror     xstd
## 1 0.509091      0   1.00000 1.00000 0.128241
## 2 0.018182      1   0.49091 0.50909 0.093842
## 3 0.010000      2   0.47273 0.58182 0.099954</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">best.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prune</span><span class="p">(</span><span class="n">model.tree</span><span class="p">,</span><span class="w">
 </span><span class="o">+</span><span class="w"> </span><span class="n">model.tree</span><span class="o">$</span><span class="n">cptable</span><span class="p">[</span><span class="n">which.min</span><span class="p">(</span><span class="n">model.tree</span><span class="o">$</span><span class="n">cptable</span><span class="p">[,</span><span class="s2">"xerror"</span><span class="p">]),</span><span class="s2">"CP"</span><span class="p">])</span></code></pre></figure>

<h3 id="acurcia-precision-e-recall-da-validao-cruzada-e-teste-para-os-melhores-modelos">Acurácia, precision e recall da validação-cruzada e teste (para os melhores modelos)</h3>

<h4 id="regresso-logstica-1">Regressão Logística</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dados.teste</span><span class="o">$</span><span class="n">best.glm.prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">best.glm.model</span><span class="p">,</span><span class="w"> </span><span class="n">dados.teste</span><span class="p">)</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dados.teste</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">best.glm.prediction</span><span class="p">)</span><span class="w">

</span><span class="n">TP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">best.glm.prediction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">TN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">best.glm.prediction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">FP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">best.glm.prediction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w"> 
</span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">best.glm.prediction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span></code></pre></figure>

<p>Comparando com o modelo anterior de regressão logística, vemos que ambos os modelos apresentam os mesmos valores para acurácia, precisão e recall. Isso significa que o novo modelo não é pior, mas também não é melhor.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Acurácia: 0.923913043478261"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Precisão: 0.5"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Recall: 0.571428571428571"</code></pre></figure>

<h4 id="rvore-de-deciso-2">Árvore de decisão</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">best.tree</span><span class="p">,</span><span class="w"> </span><span class="n">tst2</span><span class="p">))</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">predicao.best.tree</span><span class="p">[</span><span class="s1">'TRUE'</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)})</span><span class="w">
</span><span class="n">tst2</span><span class="o">$</span><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">

</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tst2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">evadiu</span><span class="p">,</span><span class="w"> </span><span class="n">predicao.best.tree</span><span class="p">)</span><span class="w">

</span><span class="n">TP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">TN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">FP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w"> 
</span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">predicao.best.tree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span></code></pre></figure>

<p>Já para o novo modelo de árvore de decisão, o valor de acurácia teve uma leve reduzida, mas ainda se mantém acima dos 90%. Por outro lado, agora é possível calcular um valor de precisão, que agora se apresenta em aproximadamente 0.45. O recall que antes era zero, foi alterado para 0.71. Vemos uma melhora considerável nesse novo modelo de árvore de decisão.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Acurácia: 0.91304347826087"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Precisão: 0.454545454545455"</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "Recall: 0.714285714285714"</code></pre></figure>

<h3 id="aplicao-do-melhor-modelo">Aplicação do melhor modelo</h3>

<p>Consideramos como melhor modelo o modelo de árvore de regressão melhorado, alguns dos motivos são:</p>

<ul>
  <li>Não podemos considerar o valor da acurária dado que os dados estão muito desbalanceados.</li>
  <li>Neste caso, o Recall é o que utilizamos para considerar o melhor modelo. É muito mais importante identificar alunos que vão evadir, classificar como false um aluno que vai evadir é considerado uma grande perda.</li>
  <li>Classificar como true um aluno que na verdade não vai evadir não implicará em grande impactos.</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pessoal.dados</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">MAT_ALU_MATRICULA</span><span class="o">=</span><span class="s2">"0674a56175b24881b769d167a199cb41"</span><span class="p">,</span><span class="w"> </span><span class="err">Á</span><span class="n">lgebra.Vetorial.e.Geometria.Anal</span><span class="err">í</span><span class="n">tica</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7.3</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="err">á</span><span class="n">lculo.Diferencial.e.Integral.I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">Introdu</span><span class="err">çã</span><span class="n">o.</span><span class="err">à</span><span class="n">.Computa</span><span class="err">çã</span><span class="n">o</span><span class="o">=</span><span class="m">8.4</span><span class="p">,</span><span class="w"> </span><span class="n">Laborat</span><span class="err">ó</span><span class="n">rio.de.Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7.7</span><span class="p">,</span><span class="w"> </span><span class="n">Leitura.e.Produ</span><span class="err">çã</span><span class="n">o.de.Textos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8.2</span><span class="p">,</span><span class="w"> </span><span class="n">Programa</span><span class="err">çã</span><span class="n">o.I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7.6</span><span class="p">,</span><span class="w"> </span><span class="n">evadiu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">Programacao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">

</span><span class="n">pessoal.predicao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">best.tree</span><span class="p">,</span><span class="w"> </span><span class="n">pessoal.dados</span><span class="p">))</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">pessoal.predicao</span><span class="p">[</span><span class="s1">'TRUE'</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)})</span><span class="w">
</span><span class="n">pessoal.predicao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">

</span><span class="n">pessoal.predicao</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  TRUE 
## FALSE 
## Levels: FALSE</code></pre></figure>

<p>Como resultado para os dados pessoais, o modelo fez a predição correta a meu respeito.</p>

  </article>

</div>


<script src="/AD2/htmlwidgets_deps/htmlwidgets-0.8/htmlwidgets.js"></script>
<script src="/AD2/htmlwidgets_deps/jquery-1.11.1/jquery.min.js"></script>
<script src="/AD2/htmlwidgets_deps/proj4js-2.3.15/proj4.js"></script>
<link href="/AD2/htmlwidgets_deps/highcharts-5.0.6/css/motion.css" rel="stylesheet" />
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/highstock.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/highcharts-3d.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/highcharts-more.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/annotations.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/broken-axis.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/data.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/drilldown.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/exporting.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/funnel.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/heatmap.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/map.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/no-data-to-display.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/offline-exporting.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/solid-gauge.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/modules/treemap.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/annotations.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/draggable-legend.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/draggable-points.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/export-csv.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/grouped-categories.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/motion.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/pattern-fill-v2.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/plugins/tooltip-delay.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/custom/reset.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/custom/symbols-extra.js"></script>
<script src="/AD2/htmlwidgets_deps/highcharts-5.0.6/custom/text-symbols.js"></script>
<link href="/AD2/htmlwidgets_deps/fontawesome-4.5.0/font-awesome.min.css" rel="stylesheet" />
<link href="/AD2/htmlwidgets_deps/htmlwdgtgrid-1/htmlwdgtgrid.css" rel="stylesheet" />
<script src="/AD2/htmlwidgets_deps/highchart-binding-0.5.0/highchart.js"></script>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Análise de Dados 2</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Análise de Dados 2</li>
          <li><a href="mailto:martha.menezes@ccc.ufcg.edu.br">martha.menezes@ccc.ufcg.edu.br</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/michellymenezes">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">michellymenezes</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Resultados dos laboratórios da disciplina.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
